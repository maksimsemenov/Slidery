!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.slidery={})}(this,function(exports){"use strict";function styleInject(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}var css=".slidery {\n  position: relative;\n}\n.slidery-target {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.slidery-no-select-text {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n.slidery-base {\n  position: relative;\n  width: 100%;\n  min-height: 2px;\n  cursor: pointer;\n  background-color: #f0f0f0;\n}\n.slidery-base__target {\n  position: absolute;\n  left: 0;\n  top: 50%;\n  width: 100%;\n  height: 100%;\n  min-height: 30px;\n  -webkit-transform: translateY(-50%);\n      -ms-transform: translateY(-50%);\n          transform: translateY(-50%);\n  cursor: pointer;\n}\n.slidery-progress {\n  position: absolute;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 50%;\n  pointer-events: none;\n  background-color: currentColor;\n}\n.slidery-lift {\n  position: absolute;\n  cursor: -webkit-grab;\n  cursor: grab;\n  top: 50%;\n  min-height: 20px;\n  min-width: 20px;\n  left: 50%;\n  -webkit-transform: translate(-50%, -50%);\n      -ms-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n@media (max-width: 576px) {\n  .slidery-lift {\n    min-width: 40px;\n    min-height: 40px;\n  }\n}\n.slidery-lift::before {\n  content: '';\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  -webkit-transform: translate(-50%, -50%);\n      -ms-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  min-height: 10px;\n  min-width: 10px;\n  border-radius: 50%;\n  background-color: currentColor;\n  -webkit-transition: -webkit-transform 0.1s ease-out, -webkit-box-shadow 0.1s ease-out;\n  transition: -webkit-transform 0.1s ease-out, -webkit-box-shadow 0.1s ease-out;\n  -o-transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;\n  transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;\n  transition: transform 0.1s ease-out, box-shadow 0.1s ease-out, -webkit-transform 0.1s ease-out, -webkit-box-shadow 0.1s ease-out;\n}\n@media (max-width: 576px) {\n  .slidery-lift::before {\n    min-width: 20px;\n    min-height: 20px;\n  }\n}\n.slidery-lift:hover::before,\n.slidery-lift.slidery-is-sliding::before {\n  -webkit-transform: translate(-50%, -50%) scale(1.7);\n      -ms-transform: translate(-50%, -50%) scale(1.7);\n          transform: translate(-50%, -50%) scale(1.7);\n  -webkit-box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.2);\n          box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.2);\n}\n.slidery-lift.slidery-is-sliding::before {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n.slidery-lift.slidery-is-sliding {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n";styleInject(css);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},initNodes=function(e){var t=e,n=t.querySelector(".slidery-base"),r=t.querySelector(".slidery-progress"),i=t.querySelector(".slidery-lift");t.classList.contains("slidery")||t.classList.add("slidery"),n||(n=document.createElement("div")).classList.add("slidery-base");var s=document.createElement("div");return s.classList.add("slidery-base__target"),n.append(s),r||(r=document.createElement("div")).classList.add("slidery-progress"),i||(i=document.createElement("div")).classList.add("slidery-lift"),t.append(n),t.append(r),t.append(i),{wrapperNode:t,baseNode:n,progressNode:r,liftNode:i}},formatValue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(null==e)return"";var r=e.toFixed(t);return"."!==n?r.replace(".",n):r},debounce=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=void 0;return function(){for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];n&&clearTimeout(n),n=setTimeout(function(){e.apply(void 0,i)},t)}},funcIdRegExp=/\[[\w-_\.]+\]/gi,getClosestStep=function(e,t,n){if(!e)return 0;if(!n||!t)return e;var r=t/n;return Math.round(e/r)*r},evalFuncWithValues=function evalFuncWithValues(func,values){var funcWithValues=Object.keys(values).reduce(function(e,t){return e.replace(new RegExp("\\["+t+"\\]","g"),values[t])},func);try{return eval(funcWithValues)}catch(e){return}},getSlidersFromHtml=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"slidery";return[].slice.call(document.querySelectorAll("."+e)).map(function(e){return{element:e,range:e.dataset.range&&/-?\d+\.\.\.-?\d+/.test(e.dataset.range)?e.dataset.range.split("...").map(function(e){return parseInt(e,10)}):void 0,value:e.dataset.initialValue&&parseInt(e.dataset.initialValue,10),id:e.id,steps:e.dataset.steps?parseInt(e.dataset.steps,10):void 0}})},getTargetsFromHtml=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"slidery-target";return[].slice.call(document.querySelectorAll("."+e)).map(function(e){var t=e.dataset.precision||0,n=e.dataset.separator||"",r=e.dataset.value?e.dataset.value.match(funcIdRegExp).map(function(e){return e.replace(/\[?\]?/g,"")}).reduce(function(e,t){return-1===e.indexOf(t)?[].concat(toConsumableArray(e),[t]):e},[]):void 0,i=r&&r.length>1?function(r){e.innerHTML=formatValue(evalFuncWithValues(e.dataset.value,r),t,n)}:function(r){return e.innerHTML=formatValue(r,t,n)};return{node:e,source:r,onSlidingStart:function(){return e.classList.add("slidery-is-sliding")},onSlidingEnd:function(){return e.classList.remove("slidery-is-sliding")},onChange:i}})},initFromHtml=function(e,t){var n=getSlidersFromHtml(e),r=getTargetsFromHtml(t);if(n.length&&r.length)return new Slidery(n,r)},Slidery=function e(t,n){var r=this;if(classCallCheck(this,e),_initialiseProps.call(this),Array.isArray(t)&&t.length>0||"object"===(void 0===t?"undefined":_typeof(t))){this.sliders={},this.activeSliders={},this.listeners={};var i=Array.isArray(t)?t:[t],s=Array.isArray(n)&&n.length?n:"object"===(void 0===n?"undefined":_typeof(n))?[n]:[];i.filter(function(e){return e&&(1===i.length||!!e.id)}).forEach(function(e){var t=e.id,n=void 0===t?(4e3*Math.random()).toString():t,o=e.element,a=e.range,l=e.value,d=e.steps;if(o){var u=s.map(function(e){var t=e.source;return"string"==typeof t&&(t=[t]),Number.isInteger(t)&&(t=[t.toString()]),Array.isArray(t)||null==t||(t=1===i.length?[n]:void 0),Object.assign({},e,{source:t})}).filter(function(e){var t=e.source;return t&&-1!==t.indexOf(n)}),c=o.getBoundingClientRect().width,f=Array.isArray(a)&&2===a.length?a:[0,c],h=c/(f[1]-f[0]),g=void 0,v=void 0;l?((g=l)<f[0]&&(g=f[0]),g>f[1]&&(g=f[1]),v=(g-f[0])*h):(v=c/2,g=f[0]+v/h);var m={baseClick:r.handleBaseNodeClick(n),liftMouseDown:r.handleLiftNodeMouseDown(n),touchStart:r.handleLiftNodeTouchStart(n)};r.listeners[n]=m;var p=initNodes(o);p.baseNode.addEventListener("click",m.baseClick),p.liftNode.addEventListener("mousedown",m.liftMouseDown),p.liftNode.addEventListener("touchstart",m.touchStart);var y=v/c*100;p.liftNode.style.left=y+"%",p.progressNode.style.width=y+"%",r.sliders[n]={id:n,nodes:p,targets:u,width:c,range:f,scale:h,stepsCount:d||void 0,value:g,progress:v}}}),Object.values(this.sliders).forEach(function(e){r.adjustTargets(e.targets,r.sliders)}),window.addEventListener("resize",debounce(this.handleWindowResize,300))}},_initialiseProps=function(){var e=this;this.handleWindowResize=function(){Object.values(e.sliders).forEach(function(e){var t=e.nodes.baseNode.getBoundingClientRect().width;e.progress=e.progress/e.width*t,e.width=t,e.scale=t/(e.range[1]-e.range[0])})},this.handleBaseNodeClick=function(t){return function(n){var r=n.offsetX;if(null==r){var i=n.target.getBoundingClientRect().left;r=n.clientX-i}e.adjustSlider(t,r,!0)}},this.handleLiftNodeMouseDown=function(t){return function(n){var r=e.sliders[t];r&&(e.activeSliders[t]={initialScreenPosition:n.screenX,initialProgress:r.progress},e.initSliderBeforeSliding(t,"mouse"))}},this.handleLiftNodeTouchStart=function(t){return function(n){var r=e.sliders[t];if(r){var i=[].slice.call(n.targetTouches),s=i.length&&i[0];s&&(e.activeSliders[t]={initialScreenPosition:s.screenX,touchId:s.identifier,initialProgress:r.progress},e.initSliderBeforeSliding(t,"touch"))}}},this.handleMouseUp=function(t){return function(n){var r=e.activeSliders[t];if(r){var i=r.initialProgress,s=r.initialScreenPosition,o=i+n.screenX-s;e.adjustSlider(t,o,!0),e.cleanupSliderAfterSliding(t,"mouse")}}},this.handleTouchEnd=function(t){return function(n){var r=e.activeSliders[t];if(r){var i=r.initialProgress,s=r.initialScreenPosition,o=r.touchId,a=[].slice.call(n.changedTouches).find(function(e){return e.identifier===o});if(a){var l=i+a.screenX-s;e.adjustSlider(t,l,!0),e.cleanupSliderAfterSliding(t,"touch")}}}},this.handleMouseMove=function(t){var n=e.activeSliders[t];if(n){var r=n.initialProgress,i=n.initialScreenPosition;return function(n){var s=r+n.screenX-i;e.adjustSlider(t,s)}}},this.handleTouchMove=function(t){var n=e.activeSliders[t];if(n){var r=n.initialProgress,i=n.initialScreenPosition,s=n.touchId;return function(n){var o=[].slice.call(n.changedTouches).find(function(e){return e.identifier===s});if(o){var a=r+o.screenX-i;e.adjustSlider(t,a)}}}},this.initSliderBeforeSliding=function(t,n){var r="mouse"===n?"MouseMove":"TouchMove",i="mouse"===n?"MouseUp":"TouchEnd",s=e["handle"+r](t),o=e["handle"+i](t);e.listeners[t][r.toLowerCase()]=s,e.listeners[t][i.toLowerCase()]=o,document.addEventListener(r.toLowerCase(),s),document.addEventListener(i.toLowerCase(),o),document.body.classList.add("slidery-no-select-text");var a=e.sliders[t];a&&(a.nodes.liftNode.classList.add("slidery-is-sliding"),a.targets.forEach(function(e){return e.onSlidingStart&&e.onSlidingStart()}))},this.cleanupSliderAfterSliding=function(t,n){e.activeSliders[t]=null;var r=e.listeners[t];if(r){var i=n+"move",s="mouse"===n?"mouseup":"touchend";r[i]&&document.removeEventListener(i,r[i]),r[s]&&document.removeEventListener(s,r[s]),e.listeners[t]={}}document.body.classList.remove("slidery-no-select-text");var o=e.sliders[t];o&&(o.nodes.liftNode.classList.remove("slidery-is-sliding"),o.targets.forEach(function(e){return e.onSlidingEnd&&e.onSlidingEnd()}))},this.adjustTargets=function(e,t){e.forEach(function(e){var n=e.onChange,r=e.source;n&&Array.isArray(r)&&n(1===r.length?t[r[0]].value:r.filter(function(e){return!!t[e]}).reduce(function(e,n){return e[n]=t[n].value,e},{}))})},this.adjustSlider=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.sliders[t];if(i){var s=n;i&&i.stepsCount&&(s=getClosestStep(n,i.width,i.stepsCount)),s<0&&(s=0),s>i.width&&(s=i.width);var o=i.range[0]+s/i.scale,a=s/i.width*100;i.nodes.liftNode.style.left=a+"%",i.nodes.progressNode.style.width=a+"%",i.value=o,r&&(i.progress=s),e.adjustTargets(i.targets,e.sliders)}}};initFromHtml(),Object.defineProperty(exports,"__esModule",{value:!0})});
